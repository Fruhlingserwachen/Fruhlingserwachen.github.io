import Vue from"vue";import Vuex from"vuex";import{getTimeInterval}from"../utils/index";import{fetchSocial,fetchSiteInfo}from"@/api";Vue.use(Vuex);const runAt="1589878800000";let timer=null;const state={loading:!1,runTimeInterval:"",socials:"",websiteInfo:""},mutations={SET_LOADING:(state,v)=>{state.loading=v},SET_SOCIALS:(state,v)=>{state.socials=v},SET_SITE_INFO:(state,v)=>{state.websiteInfo=v},GET_RUNTIME_INTERVAL:state=>{timer&&state.runTimeInterval||(clearInterval(timer),timer=setInterval(()=>{state.runTimeInterval=getTimeInterval(runAt)},1e3))}},actions={setLoading:({commit:commit},v)=>{commit("SET_LOADING",v)},initComputeTime:({commit:commit})=>{commit("GET_RUNTIME_INTERVAL")},getSiteInfo:({commit:commit,state:state})=>new Promise(resolve=>{state.websiteInfo?resolve(state.websiteInfo):fetchSiteInfo().then(res=>{let data=res.data||{};commit("SET_SITE_INFO",data),resolve(data)}).catch(err=>{resolve({})})}),getSocials:({commit:commit,state:state})=>new Promise(resolve=>{state.socials?resolve(state.socials):fetchSocial().then(res=>{let data=res.data||[];commit("SET_SOCIALS",data),resolve(data)}).catch(err=>{resolve([])})})},getters={loading:state=>state.loading,runTimeInterval:state=>state.runTimeInterval,notice:state=>state.websiteInfo?state.websiteInfo.notice:""};export default new Vuex.Store({state:state,mutations:mutations,actions:actions,modules:{},getters:getters});